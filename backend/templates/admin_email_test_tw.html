<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Email Test - Trace Extension</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Custom Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            DEFAULT: 'hsl(260, 84%, 65%)',
                            foreground: 'hsl(0, 0%, 98%)',
                            hover: 'hsl(260, 84%, 70%)',
                            muted: 'hsl(260, 30%, 95%)',
                        },
                        secondary: {
                            DEFAULT: 'hsl(217, 91%, 60%)',
                            foreground: 'hsl(0, 0%, 98%)',
                            hover: 'hsl(217, 91%, 65%)',
                            muted: 'hsl(217, 30%, 95%)',
                        },
                        accent: {
                            DEFAULT: 'hsl(14, 90%, 65%)',
                            foreground: 'hsl(0, 0%, 98%)',
                            hover: 'hsl(14, 90%, 70%)',
                            muted: 'hsl(14, 30%, 95%)',
                        },
                        background: 'hsl(240, 10%, 98%)',
                        foreground: 'hsl(240, 10%, 8%)',
                        card: {
                            DEFAULT: 'hsl(0, 0%, 100%)',
                            foreground: 'hsl(240, 10%, 8%)',
                        },
                        muted: {
                            DEFAULT: 'hsl(240, 5%, 96%)',
                            foreground: 'hsl(240, 5%, 45%)',
                        },
                        destructive: {
                            DEFAULT: 'hsl(0, 84%, 60%)',
                            foreground: 'hsl(0, 0%, 98%)',
                        },
                        border: 'hsl(240, 6%, 90%)',
                        input: 'hsl(240, 6%, 96%)',
                        ring: 'hsl(260, 84%, 65%)',
                    },
                    fontFamily: {
                        'sans': ['Inter', 'system-ui', '-apple-system', 'sans-serif'],
                        'heading': ['Space Grotesk', 'system-ui', '-apple-system', 'sans-serif'],
                    },
                    backgroundImage: {
                        'gradient-primary': 'linear-gradient(135deg, hsl(260, 84%, 65%), hsl(217, 91%, 60%))',
                        'gradient-hero': 'linear-gradient(135deg, hsl(260, 84%, 65%) 0%, hsl(217, 91%, 60%) 50%, hsl(14, 90%, 65%) 100%)',
                        'gradient-subtle': 'linear-gradient(180deg, hsl(240, 10%, 98%), hsl(240, 5%, 96%))',
                    },
                    boxShadow: {
                        'glow': '0 0 40px hsl(260, 84%, 65%, 0.3)',
                        'glow-lg': '0 0 60px hsl(260, 84%, 65%, 0.4)',
                    },
                }
            }
        }
    </script>

    <style>
        body { font-family: 'Inter', system-ui, -apple-system, sans-serif; }
        .text-gradient {
            background: linear-gradient(135deg, hsl(260, 84%, 65%), hsl(217, 91%, 60%));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .hover-lift { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .hover-lift:hover { transform: translateY(-2px); }
    </style>
</head>
<body class="bg-background min-h-screen font-sans">
    <!-- Navigation -->
    <nav class="bg-card shadow-sm border-b border-border">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex">
                    <div class="flex-shrink-0 flex items-center">
                        <h1 class="text-xl font-heading font-bold text-foreground">Trace Admin</h1>
                    </div>
                    <div class="hidden sm:ml-6 sm:flex sm:space-x-8">
                        <a href="/admin/dashboard" class="border-transparent text-muted-foreground hover:border-border hover:text-foreground inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium transition-all">
                            Dashboard
                        </a>
                        <a href="/admin/feedback" class="border-transparent text-muted-foreground hover:border-border hover:text-foreground inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium transition-all">
                            Feedback
                        </a>
                        <a href="/admin/products" class="border-transparent text-muted-foreground hover:border-border hover:text-foreground inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium transition-all">
                            Products
                        </a>
                        <a href="/admin/prompt-test" class="border-transparent text-muted-foreground hover:border-border hover:text-foreground inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium transition-all">
                            Prompt Test
                        </a>
                        <a href="/admin/email-test" class="border-primary text-foreground inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium transition-all">
                            Email Test
                        </a>
                        <a href="/admin/style-guide" class="border-transparent text-muted-foreground hover:border-border hover:text-foreground inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium transition-all">
                            Style Guide
                        </a>
                        <a href="/admin/landing-page" class="border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">
                            Landing Page
                        </a>
                        <a href="/admin/logo" class="border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">
                            Logo
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
        <div class="px-4 py-6 sm:px-0">
            <div class="mb-6">
                <h2 class="text-2xl font-heading font-bold text-gradient">Email Configuration Test</h2>
                <p class="text-muted-foreground">Test SMTP configuration and send test emails</p>
            </div>

            <!-- SMTP Configuration Display -->
            <div class="bg-card rounded-lg shadow-sm border border-border p-6 mb-6">
                <h3 class="text-lg font-heading font-semibold text-foreground mb-4">Current SMTP Configuration</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="bg-muted rounded-lg p-4">
                        <div class="text-sm font-medium text-muted-foreground mb-1">SMTP Host</div>
                        <div class="text-foreground font-mono text-sm">{{ smtp_host }}</div>
                    </div>
                    <div class="bg-muted rounded-lg p-4">
                        <div class="text-sm font-medium text-muted-foreground mb-1">SMTP Port</div>
                        <div class="text-foreground font-mono text-sm">{{ smtp_port }}</div>
                    </div>
                    <div class="bg-muted rounded-lg p-4">
                        <div class="text-sm font-medium text-muted-foreground mb-1">SMTP User</div>
                        <div class="text-foreground font-mono text-sm">{{ smtp_user }}</div>
                    </div>
                    <div class="bg-muted rounded-lg p-4">
                        <div class="text-sm font-medium text-muted-foreground mb-1">SMTP Password</div>
                        <div class="text-foreground font-mono text-sm">{{ smtp_pass_masked }}</div>
                    </div>
                    <div class="bg-muted rounded-lg p-4">
                        <div class="text-sm font-medium text-muted-foreground mb-1">From Email</div>
                        <div class="text-foreground font-mono text-sm">{{ smtp_from }}</div>
                    </div>
                    <div class="bg-muted rounded-lg p-4">
                        <div class="text-sm font-medium text-muted-foreground mb-1">Admin Email</div>
                        <div class="text-foreground font-mono text-sm">{{ admin_email }}</div>
                    </div>
                </div>

                {% if smtp_configured %}
                <div class="mt-4 flex items-center text-sm">
                    <svg class="w-5 h-5 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                    </svg>
                    <span class="text-green-600 font-medium">SMTP is configured</span>
                </div>
                {% else %}
                <div class="mt-4 flex items-center text-sm">
                    <svg class="w-5 h-5 text-yellow-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                    </svg>
                    <span class="text-yellow-600 font-medium">SMTP credentials not configured</span>
                </div>
                {% endif %}
            </div>

            <!-- Test Email Section -->
            <div class="bg-card rounded-lg shadow-sm border border-border p-6">
                <h3 class="text-lg font-heading font-semibold text-foreground mb-4">Send Test Email</h3>
                <p class="text-sm text-muted-foreground mb-6">
                    Send a test email to <strong>{{ admin_email }}</strong> to verify SMTP configuration is working correctly.
                </p>

                <button id="sendTestEmailBtn"
                        class="inline-flex items-center px-6 py-3 bg-gradient-primary text-primary-foreground font-medium rounded-lg hover:opacity-90 transition-all shadow-md hover:shadow-glow disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                    </svg>
                    <span id="btnText">Send Test Email</span>
                    <svg id="loadingSpinner" class="hidden animate-spin ml-2 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                </button>

                <!-- Status Message -->
                <div id="statusMessage" class="hidden mt-4 p-4 rounded-lg"></div>

                <!-- Email Log -->
                <div id="emailLog" class="hidden mt-6">
                    <h4 class="text-md font-heading font-semibold text-foreground mb-3">Email Send Log</h4>
                    <div class="bg-muted rounded-lg p-4">
                        <pre id="logContent" class="text-xs font-mono text-foreground whitespace-pre-wrap overflow-x-auto"></pre>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        document.getElementById('sendTestEmailBtn').addEventListener('click', async function() {
            const btn = this;
            const btnText = document.getElementById('btnText');
            const spinner = document.getElementById('loadingSpinner');
            const statusMessage = document.getElementById('statusMessage');
            const emailLog = document.getElementById('emailLog');
            const logContent = document.getElementById('logContent');

            // Disable button and show loading
            btn.disabled = true;
            btnText.textContent = 'Sending...';
            spinner.classList.remove('hidden');
            statusMessage.classList.add('hidden');
            emailLog.classList.add('hidden');

            try {
                const response = await fetch('/admin/api/send-test-email', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });

                const data = await response.json();

                // Show status message
                statusMessage.classList.remove('hidden');

                if (data.success) {
                    statusMessage.className = 'mt-4 p-4 rounded-lg bg-green-50 border border-green-200';
                    statusMessage.innerHTML = `
                        <div class="flex items-start">
                            <svg class="w-5 h-5 text-green-500 mr-3 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                            </svg>
                            <div>
                                <h4 class="text-sm font-semibold text-green-800">Email Sent Successfully!</h4>
                                <p class="text-sm text-green-700 mt-1">${data.message}</p>
                                <p class="text-xs text-green-600 mt-2">Check your inbox at: <strong>${data.recipient}</strong></p>
                            </div>
                        </div>
                    `;

                    // Show log if available
                    if (data.log) {
                        emailLog.classList.remove('hidden');
                        logContent.textContent = data.log;
                    }
                } else {
                    statusMessage.className = 'mt-4 p-4 rounded-lg bg-red-50 border border-red-200';
                    statusMessage.innerHTML = `
                        <div class="flex items-start">
                            <svg class="w-5 h-5 text-red-500 mr-3 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                            </svg>
                            <div>
                                <h4 class="text-sm font-semibold text-red-800">Failed to Send Email</h4>
                                <p class="text-sm text-red-700 mt-1">${data.error || 'Unknown error occurred'}</p>
                            </div>
                        </div>
                    `;

                    // Show error log if available
                    if (data.log) {
                        emailLog.classList.remove('hidden');
                        logContent.textContent = data.log;
                    }
                }
            } catch (error) {
                statusMessage.classList.remove('hidden');
                statusMessage.className = 'mt-4 p-4 rounded-lg bg-red-50 border border-red-200';
                statusMessage.innerHTML = `
                    <div class="flex items-start">
                        <svg class="w-5 h-5 text-red-500 mr-3 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                        </svg>
                        <div>
                            <h4 class="text-sm font-semibold text-red-800">Request Failed</h4>
                            <p class="text-sm text-red-700 mt-1">${error.message}</p>
                        </div>
                    </div>
                `;
            } finally {
                // Re-enable button
                btn.disabled = false;
                btnText.textContent = 'Send Test Email';
                spinner.classList.add('hidden');
            }
        });
    </script>
</body>
</html>
