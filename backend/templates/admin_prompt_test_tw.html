<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prompt Testing - Trace Admin</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Custom Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#eff6ff',
                            100: '#dbeafe', 
                            200: '#bfdbfe',
                            300: '#93c5fd',
                            400: '#60a5fa',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                            800: '#1e40af',
                            900: '#1e3a8a',
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Navigation -->
    <nav class="bg-white shadow-sm border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex">
                    <div class="flex-shrink-0 flex items-center">
                        <h1 class="text-xl font-bold text-gray-900">Trace Admin</h1>
                    </div>
                    <div class="hidden sm:ml-6 sm:flex sm:space-x-8">
                        <a href="/admin/dashboard" id="adminLink" class="border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">
                            Dashboard
                        </a>
                        <a href="/admin/feedback" id="adminFeedbackLink" class="border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">
                            Feedback
                        </a>
                        <a href="/admin/products" id="adminProductsLink" class="border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">
                            Products
                        </a>
                        <a href="/admin/prompt-test" id="adminPromptTestLink" class="border-primary-500 text-gray-900 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">
                            Prompt Test
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
        <div class="px-4 py-6 sm:px-0">
            <!-- Configuration Panel - Horizontal Layout -->
            <div class="bg-white rounded-lg shadow p-6 mb-6">
                <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
                    <!-- Test Articles -->
                    <div>
                        <h3 class="text-md font-semibold text-gray-900 mb-3">Select Test Article</h3>
                        <div class="space-y-1">
                            <label class="flex items-center p-2 border rounded cursor-pointer hover:bg-gray-50 text-sm">
                                <input type="radio" name="article" value="tech" class="mr-2" checked>
                                <div>
                                    <div class="font-medium">TechCrunch: AI</div>
                                    <div class="text-xs text-gray-500">AI developments</div>
                                </div>
                            </label>
                            
                            <label class="flex items-center p-2 border rounded cursor-pointer hover:bg-gray-50 text-sm">
                                <input type="radio" name="article" value="science" class="mr-2">
                                <div>
                                    <div class="font-medium">Nature: Climate</div>
                                    <div class="text-xs text-gray-500">Ocean currents</div>
                                </div>
                            </label>
                            
                            <label class="flex items-center p-2 border rounded cursor-pointer hover:bg-gray-50 text-sm">
                                <input type="radio" name="article" value="business" class="mr-2">
                                <div>
                                    <div class="font-medium">WSJ: Markets</div>
                                    <div class="text-xs text-gray-500">Tech stocks analysis</div>
                                </div>
                            </label>
                            
                            <label class="flex items-center p-2 border rounded cursor-pointer hover:bg-gray-50 text-sm">
                                <input type="radio" name="article" value="health" class="mr-2">
                                <div>
                                    <div class="font-medium">Harvard: Sleep</div>
                                    <div class="text-xs text-gray-500">Sleep research</div>
                                </div>
                            </label>
                            
                            <label class="flex items-center p-2 border rounded cursor-pointer hover:bg-gray-50 text-sm">
                                <input type="radio" name="article" value="history" class="mr-2">
                                <div>
                                    <div class="font-medium">Smithsonian</div>
                                    <div class="text-xs text-gray-500">Maya discovery</div>
                                </div>
                            </label>
                        </div>
                    </div>

                    <!-- Reader Type -->
                    <div>
                        <h3 class="text-md font-semibold text-gray-900 mb-3">Reader Type</h3>
                        <div class="space-y-1">
                            <label class="flex items-center p-2 border rounded cursor-pointer hover:bg-gray-50 text-sm">
                                <input type="radio" name="readerType" value="student" class="mr-2">
                                <span>üéì Student</span>
                            </label>
                            <label class="flex items-center p-2 border rounded cursor-pointer hover:bg-gray-50 text-sm">
                                <input type="radio" name="readerType" value="business" class="mr-2">
                                <span>üíº Business Professional</span>
                            </label>
                            <label class="flex items-center p-2 border rounded cursor-pointer hover:bg-gray-50 text-sm">
                                <input type="radio" name="readerType" value="researcher" class="mr-2">
                                <span>üî¨ Researcher/Academic</span>
                            </label>
                            <label class="flex items-center p-2 border rounded cursor-pointer hover:bg-gray-50 text-sm">
                                <input type="radio" name="readerType" value="tech" class="mr-2">
                                <span>üíª Tech Professional</span>
                            </label>
                            <label class="flex items-center p-2 border rounded cursor-pointer hover:bg-gray-50 text-sm">
                                <input type="radio" name="readerType" value="lifelong_learner" class="mr-2" checked>
                                <span>üìñ Lifelong Learner</span>
                            </label>
                            <label class="flex items-center p-2 border rounded cursor-pointer hover:bg-gray-50 text-sm">
                                <input type="radio" name="readerType" value="creative" class="mr-2">
                                <span>üé® Creative Professional</span>
                            </label>
                        </div>
                    </div>

                    <!-- Reading Level -->
                    <div>
                        <h3 class="text-md font-semibold text-gray-900 mb-3">Reading Level</h3>
                        <div class="space-y-1">
                            <label class="flex items-center p-2 border rounded cursor-pointer hover:bg-gray-50 text-sm">
                                <input type="radio" name="readingLevel" value="simple" class="mr-2">
                                <span>üü¢ Quick & Simple</span>
                            </label>
                            <label class="flex items-center p-2 border rounded cursor-pointer hover:bg-gray-50 text-sm">
                                <input type="radio" name="readingLevel" value="balanced" class="mr-2" checked>
                                <span>üü° Clear & Balanced</span>
                            </label>
                            <label class="flex items-center p-2 border rounded cursor-pointer hover:bg-gray-50 text-sm">
                                <input type="radio" name="readingLevel" value="detailed" class="mr-2">
                                <span>üîµ Detailed & Thorough</span>
                            </label>
                            <label class="flex items-center p-2 border rounded cursor-pointer hover:bg-gray-50 text-sm">
                                <input type="radio" name="readingLevel" value="technical" class="mr-2">
                                <span>üü£ Technical & Expert</span>
                            </label>
                        </div>
                    </div>

                    <!-- Summary Style & Actions -->
                    <div>
                        <h3 class="text-md font-semibold text-gray-900 mb-3">Summary Style</h3>
                        <div class="space-y-1 mb-3">
                            <label class="flex items-center p-2 border rounded cursor-pointer hover:bg-gray-50 text-sm">
                                <input type="radio" name="summaryStyle" value="quick" class="mr-2">
                                <span>Quick Summary (1 sentence)</span>
                            </label>
                            <label class="flex items-center p-2 border rounded cursor-pointer hover:bg-gray-50 text-sm">
                                <input type="radio" name="summaryStyle" value="eli8" class="mr-2" checked>
                                <span>Explain Like I'm 8</span>
                            </label>
                            <label class="flex items-center p-2 border rounded cursor-pointer hover:bg-gray-50 text-sm">
                                <input type="radio" name="summaryStyle" value="detailed" class="mr-2">
                                <span>Detailed Summary (5 bullets)</span>
                            </label>
                        </div>
                        
                        <!-- Action Buttons -->
                        <div class="space-y-2">
                            <button id="showPromptBtn" class="w-full px-3 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 text-sm">
                                üîç Show Prompt
                            </button>
                            <button id="summarizeBtn" class="w-full px-3 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-primary-500 text-sm">
                                ‚ö° Summarize
                            </button>
                            <button id="clearBtn" class="w-full px-3 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 text-sm">
                                üóëÔ∏è Clear
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Results Section -->
            <div class="space-y-6">
                <!-- Loading Section -->
                <div id="loadingSection" class="bg-white rounded-lg shadow p-6 hidden">
                    <div class="flex items-center justify-center py-4">
                        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"></div>
                        <span class="ml-3 text-gray-700">Processing...</span>
                    </div>
                </div>

                <!-- Error Section -->
                <div id="errorSection" class="bg-red-50 border border-red-200 rounded-lg p-6 hidden">
                    <div class="flex">
                        <div class="ml-3">
                            <h3 class="text-sm font-medium text-red-800">Error</h3>
                            <div class="mt-2 text-sm text-red-700">
                                <p id="errorMessage"></p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Generated Prompt -->
                <div id="promptSection" class="bg-white rounded-lg shadow p-6 hidden">
                    <div class="flex justify-between items-start mb-4">
                        <h2 class="text-lg font-semibold text-gray-900">Generated Prompt</h2>
                        <button id="copyPromptBtn" class="px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200">
                            üìã Copy
                        </button>
                    </div>
                    <pre id="promptDisplay" class="bg-gray-50 p-4 rounded-md text-sm text-gray-700 whitespace-pre-wrap font-mono overflow-x-auto"></pre>
                    <div class="mt-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Edit Prompt (Optional)</label>
                        <textarea id="customPrompt" rows="10" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500 font-mono text-sm"></textarea>
                    </div>
                </div>

                <!-- Summary Result -->
                <div id="resultSection" class="bg-white rounded-lg shadow p-6 hidden">
                    <div class="flex justify-between items-start mb-4">
                        <h2 class="text-lg font-semibold text-gray-900">Summary Result</h2>
                        <div class="text-sm text-gray-500">
                            <span id="tokenCount"></span> | <span id="responseTime"></span>
                        </div>
                    </div>
                    <div id="summaryContent" class="prose max-w-none text-gray-700"></div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Get JWT token from URL
        const urlParams = new URLSearchParams(window.location.search);
        const token = urlParams.get('token');

        if (!token) {
            window.location.href = '/admin/login';
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Preserve token in navigation links
            if (token) {
                const adminLink = document.getElementById('adminLink');
                const adminFeedbackLink = document.getElementById('adminFeedbackLink');
                const adminProductsLink = document.getElementById('adminProductsLink');
                const adminPromptTestLink = document.getElementById('adminPromptTestLink');
                
                if (adminLink) {
                    adminLink.href = `/admin/dashboard?token=${token}`;
                }
                if (adminFeedbackLink) {
                    adminFeedbackLink.href = `/admin/feedback?token=${token}`;
                }
                if (adminProductsLink) {
                    adminProductsLink.href = `/admin/products?token=${token}`;
                }
                if (adminPromptTestLink) {
                    adminPromptTestLink.href = `/admin/prompt-test?token=${token}`;
                }
            }
        });

        // Test articles with mock content
        const testArticles = {
            tech: {
                title: "Revolutionary AI Model Achieves Human-Level Reasoning",
                url: "https://techcrunch.com/2024/ai-breakthrough-llm",
                content: `Researchers at leading AI labs have announced a breakthrough in artificial intelligence that brings machines closer to human-level reasoning capabilities. The new model, dubbed "ReasonNet," demonstrates unprecedented ability to solve complex logical problems and engage in multi-step reasoning tasks that were previously thought to be decades away.

The breakthrough comes after years of research into transformer architectures and represents a significant leap forward in artificial general intelligence (AGI) development. Unlike previous models that relied heavily on pattern matching and statistical inference, ReasonNet appears to engage in genuine logical reasoning, showing the ability to work through problems step-by-step and explain its reasoning process.

Key capabilities include solving mathematical proofs, engaging in complex scientific reasoning, and demonstrating common-sense understanding that has long eluded AI systems. The model scored 94% on advanced reasoning benchmarks, compared to previous state-of-the-art models that achieved only 67%.

The implications for industries ranging from healthcare and education to scientific research and software development are profound. However, researchers emphasize the importance of careful deployment and ongoing safety research as these capabilities approach human-level performance.`
            },
            science: {
                title: "Major Ocean Current System Shows Signs of Critical Slowdown",
                url: "https://nature.com/articles/climate-ocean-currents",
                content: `A comprehensive new study published in Nature Climate Change reveals that the Atlantic Meridional Overturning Circulation (AMOC), a crucial ocean current system that helps regulate global climate, is showing unprecedented signs of weakening that could trigger abrupt climate changes within decades.

The AMOC acts as a massive conveyor belt, transporting warm water northward along the surface and cold water southward at depth. This circulation pattern plays a critical role in maintaining Europe's relatively mild climate and influences weather patterns across the globe.

Researchers analyzed 150 years of temperature and salinity data from across the Atlantic Ocean, using advanced machine learning techniques to identify early warning signals of potential collapse. The study found that key indicators suggest the system may be approaching a critical tipping point, with current strength at its weakest level in over 1,000 years.

If the AMOC were to shut down or significantly weaken, the consequences would include rapid cooling in Europe, rising sea levels along the US East Coast, altered precipitation patterns affecting agriculture globally, and disruption of monsoon systems that billions depend on for freshwater.

The findings underscore the urgent need for aggressive climate action to prevent crossing irreversible tipping points in Earth's climate system.`
            },
            business: {
                title: "Tech Sector Defies Market Volatility with Strong Q4 Performance",
                url: "https://wsj.com/tech-stocks-q4-analysis",
                content: `Despite broader market uncertainty and economic headwinds, major technology companies delivered robust fourth-quarter earnings that exceeded analyst expectations, driving a late-year rally in tech stocks and reinforcing the sector's resilience.

Leading the charge were cloud computing giants, with Amazon Web Services reporting 35% year-over-year growth and Microsoft Azure posting 42% growth. The artificial intelligence boom continued to fuel enterprise spending on cloud infrastructure, with companies investing heavily in AI capabilities and data processing capacity.

Semiconductor companies also showed surprising strength, with NVIDIA reporting record quarterly revenue driven by demand for AI chips. Despite earlier concerns about supply chain disruptions and geopolitical tensions affecting chip manufacturing, the sector demonstrated remarkable adaptability and innovation.

Consumer technology companies faced a more mixed landscape, with streaming services and social media platforms grappling with market saturation and increased competition. However, companies that successfully pivoted to AI-enhanced services and productivity tools saw significant user growth and engagement.

The strong performance has led to upgraded outlook forecasts for 2024, with analysts predicting continued growth driven by enterprise AI adoption, edge computing expansion, and the rollout of 5G applications. However, experts caution that regulatory scrutiny and potential economic recession risks could impact the sector's momentum in the coming year.`
            },
            health: {
                title: "Groundbreaking Sleep Study Reveals Critical Links to Immune Function",
                url: "https://health.harvard.edu/sleep-immune-system",
                content: `A landmark longitudinal study conducted by Harvard Medical School researchers has uncovered profound connections between sleep quality and immune system function, revealing that even minor sleep disruptions can significantly compromise the body's ability to fight infections and maintain health.

The 10-year study followed 50,000 participants across diverse demographics, tracking their sleep patterns, immune biomarkers, and health outcomes. Using advanced wearable technology and regular blood sampling, researchers discovered that individuals who consistently slept less than 6 hours per night showed 70% higher rates of respiratory infections and took 50% longer to recover from illness.

Perhaps most striking was the discovery that sleep quality matters as much as quantity. Participants with fragmented sleep‚Äîfrequent awakenings even if total sleep time was adequate‚Äîshowed similar immune impairments to those with insufficient sleep duration. The study identified specific sleep stages crucial for immune function, particularly deep sleep phases when the body produces infection-fighting cells.

The research team also investigated sleep's role in vaccine effectiveness, finding that people who slept poorly in the weeks following vaccination produced 50% fewer antibodies than well-rested individuals. This finding has significant implications for public health policy and vaccination strategies.

The study's findings support implementing sleep hygiene as a critical component of preventive healthcare, with researchers recommending 7-9 hours of uninterrupted sleep for optimal immune function.`
            },
            history: {
                title: "Advanced LiDAR Survey Reveals Massive Maya Civilization Hidden in Guatemala",
                url: "https://smithsonianmag.com/maya-discovery-2024",
                content: `An international team of archaeologists using cutting-edge LiDAR technology has discovered what may be the largest Maya settlement ever found, hidden beneath dense jungle canopy in northern Guatemala. The revelation fundamentally challenges our understanding of ancient Maya civilization's scope and sophistication.

The survey, conducted over 2,100 square kilometers of the Mirador-Calakmul Karst Basin, revealed a massive network of interconnected cities, agricultural systems, and monumental architecture dating from 1000 BCE to 150 CE. The newly mapped settlement includes over 1,000 sites connected by 177 kilometers of raised stone roadways, suggesting a level of regional integration previously unknown in ancient Mesoamerica.

Most remarkably, the LiDAR data revealed sophisticated water management systems, including complex networks of canals, reservoirs, and dams that allowed the Maya to thrive in an otherwise challenging environment. These innovations enabled sustainable agriculture that supported population densities far exceeding previous estimates.

The discovery includes several pyramids larger than those at the famous site of Tikal, with the largest structure measuring over 72 meters in height. Complex palace structures, ball courts, and defensive fortifications indicate a highly organized society with advanced architectural knowledge.

Carbon dating and ceramic analysis suggest this civilization flourished for over a millennium, contradicting theories about early Maya society being composed of scattered, small-scale communities. The findings provide crucial insights into how ancient civilizations managed environmental challenges and organized complex societies.`
            }
        };

        // Show prompt generation
        document.getElementById('showPromptBtn').addEventListener('click', function() {
            const selectedArticle = document.querySelector('input[name="article"]:checked').value;
            const readerType = document.querySelector('input[name="readerType"]:checked').value;
            const readingLevel = document.querySelector('input[name="readingLevel"]:checked').value;
            const summaryStyle = document.querySelector('input[name="summaryStyle"]:checked').value;

            const article = testArticles[selectedArticle];
            const settings = {
                reader_type: readerType,
                reading_level: readingLevel,
                summary_style: summaryStyle
            };

            // Generate prompt based on settings
            let prompt = generatePrompt(settings, article);
            
            document.getElementById('promptDisplay').textContent = prompt;
            document.getElementById('customPrompt').value = prompt;
            document.getElementById('promptSection').classList.remove('hidden');
        });

        // Summarize with current settings
        document.getElementById('summarizeBtn').addEventListener('click', async function() {
            const selectedArticle = document.querySelector('input[name="article"]:checked').value;
            const article = testArticles[selectedArticle];
            const settings = {
                reader_type: document.querySelector('input[name="readerType"]:checked').value,
                reading_level: document.querySelector('input[name="readingLevel"]:checked').value,
                summary_style: document.querySelector('input[name="summaryStyle"]:checked').value
            };

            // Use custom prompt if available, otherwise generate
            let prompt = document.getElementById('customPrompt').value;
            if (!prompt) {
                prompt = generatePrompt(settings, article);
            }

            try {
                document.getElementById('loadingSection').classList.remove('hidden');
                document.getElementById('errorSection').classList.add('hidden');
                document.getElementById('resultSection').classList.add('hidden');

                const startTime = Date.now();
                
                const response = await fetch('/api/admin/test-prompt', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        prompt: prompt,
                        article_url: article.url,
                        article_title: article.title,
                        settings: settings
                    })
                });

                const data = await response.json();
                const responseTime = Date.now() - startTime;

                if (data.success) {
                    document.getElementById('summaryContent').innerHTML = data.summary.replace(/\n/g, '<br>');
                    document.getElementById('tokenCount').textContent = `${data.token_count || 'N/A'} tokens`;
                    document.getElementById('responseTime').textContent = `${responseTime}ms`;
                    document.getElementById('resultSection').classList.remove('hidden');
                } else {
                    throw new Error(data.error || 'Unknown error occurred');
                }
            } catch (error) {
                console.error('Summarization error:', error);
                document.getElementById('errorMessage').textContent = error.message;
                document.getElementById('errorSection').classList.remove('hidden');
            } finally {
                document.getElementById('loadingSection').classList.add('hidden');
            }
        });

        // Clear results
        document.getElementById('clearBtn').addEventListener('click', function() {
            document.getElementById('promptSection').classList.add('hidden');
            document.getElementById('resultSection').classList.add('hidden');
            document.getElementById('errorSection').classList.add('hidden');
            document.getElementById('customPrompt').value = '';
        });

        // Copy prompt to clipboard
        document.getElementById('copyPromptBtn').addEventListener('click', function() {
            const promptText = document.getElementById('promptDisplay').textContent;
            navigator.clipboard.writeText(promptText).then(() => {
                this.textContent = '‚úÖ Copied';
                setTimeout(() => {
                    this.textContent = 'üìã Copy';
                }, 2000);
            });
        });

        function generatePrompt(settings, article) {
            // Generate prompt based on user settings and article
            const readerTypePrompts = {
                student: "You are helping a student understand this content for academic purposes.",
                business: "You are helping a business professional quickly grasp key insights for decision-making.",
                researcher: "You are helping a researcher understand this content with academic rigor and detail.",
                tech: "You are helping a technical professional understand this content with focus on implementation and technical details.",
                lifelong_learner: "You are helping a curious lifelong learner explore and understand this topic.",
                creative: "You are helping a creative professional find inspiration and unique perspectives in this content."
            };

            const readingLevelPrompts = {
                simple: "Use simple language and explain concepts in the most straightforward way possible.",
                balanced: "Use clear, accessible language while maintaining accuracy and depth.",
                detailed: "Provide comprehensive explanations with supporting details and context.",
                technical: "Use precise technical language and detailed explanations for expert-level understanding."
            };

            const summaryStylePrompts = {
                quick: "Provide a concise one-sentence summary that captures the main point.",
                eli8: "Explain the key points as if talking to an 8-year-old, using simple words and relatable examples.",
                detailed: "Create a detailed summary with 5 key bullet points covering the most important aspects."
            };

            return `${readerTypePrompts[settings.reader_type]} ${readingLevelPrompts[settings.reading_level]} ${summaryStylePrompts[settings.summary_style]}

Article Title: ${article.title}
Article URL: ${article.url}

Please summarize the following article content:

${article.content}`;
        }
    </script>
</body>
</html>